{
    "collab_server" : "",
    "contents" : "# Author: Eileen Wei\n# Email: haochiw@andrew.cmu.edu\n\n##########################################################################################################################\n##################################        Set-up       ################################################################### \n##########################################################################################################################\nlibrary(sp)\nlibrary(rgdal)\nlibrary(gpclib)\nlibrary(ggmap)\nlibrary(ggplot2)\n#library(spatstat)\n#library(PBSmapping)\nlibrary(maptools)\nlibrary(Cairo)\nlibrary(scales)\nlibrary(spatstat)\nlibrary(raster)    \n# give maptools the permission to use gpclib\ngpclibPermit()\nlibrary(splitstackshape)\n\nlibrary(shiny)\nlibrary(leaflet)\n\n\n#grab a palette\nlibrary(RColorBrewer)\n\n# Objects in this file are shared across all sessions\n#source('data_processor.R', local=TRUE)\n# blocks_seattle <- readRDS(\"/Users/EILEENWEI/Team5/DataObjects\",\"block_seattle.rds\")\nblocks_seattle <- block_seattle\n\n\n\n\nshinyServer(function(input, output) {\n  \n  pal <- colorNumeric(\n    palette = colorRampPalette(c(\"green\",\"red\")),\n    domain = blocks_seattle@data$count)\n  \n  ## Map\n  popup<-paste(sep = \"<br/>\",\n               paste0(\"<b>Seattle Crime</b>\"),\n               paste0(\"<b>Block:</b> \",blocks_seattle@data$GEOID),\n               paste0(\"<b>Criminal Incidents:</b> \",blocks_seattle@data$count)\n  )\n  \n  factpal <- colorFactor(topo.colors(5), blocks_seattle@data$count)\n  \n  restaurant <- read.csv(\"Data/RestaurantData.csv\", header = TRUE)\n  parking <- read.csv(\"Data/Parking.csv\", header = TRUE)\n  parkingtemp<-parking\n  \n  output$resList <- renderUI({\n           \"radioButtons\" =  radioButtons(\"dynamic\", \"Search Result\", \n                                          choices = c(\"Bar & Grill\"=\"11\", \"Appricot Takeover\" = \"13\"), \n                                          selected=\"11\")\n  })\n  \n  \n  earth<- function (long1, lat1, long2, lat2)\n  {\n    rad <- pi/180\n    a1 <- lat1 * rad\n    a2 <- long1 * rad\n    b1 <- lat2 * rad\n    b2 <- long2 * rad\n    dlon <- b2 - a2\n    dlat <- b1 - a1\n    a <- (sin(dlat/2))^2 + cos(a1) * cos(b1) * (sin(dlon/2))^2\n    c <- 2 * atan2(sqrt(a), sqrt(1 - a))\n    R <- 6378.145\n    d <- R * c\n    return(d)\n  }\n  \n  calcParking <- function(n){\n    parkingtemp$Distance<-as.numeric(earth(long(), lat(), parking$Longitude, parking$Latitude))\n    print(parkingtemp)\n    parkingtemp <- parkingtemp[which(parkingtemp$Distance<=1), ]\n    print(parkingtemp)\n    return(parkingtemp)\n  }\n  \n  \n  lat <- reactive({as.numeric(restaurant[grep(input$dynamic, restaurant$ID),4])})\n  long <- reactive({as.numeric(restaurant[grep(input$dynamic, restaurant$ID),5])})\n  res <- reactive({(restaurant[grep(input$dynamic, restaurant$ID),2:5])}) \n  parkingdata<-reactive({calcParking(input$dynamic)}) \n  \n \n   output$latlong <- renderText({\n    paste(\"Name:\", res()$Name, \"Address:\", res()$Address)\n  })\n  \n  ##output$dynamic_value <- renderPrint({\n    ##str(input$dynamic)\n  ##})\n  \n  carpark <- makeIcon(\n    iconUrl = \"parking.png\",\n    iconWidth = 28, iconHeight = 38)\n  \n  yelpmark <- makeIcon(\n    iconUrl = \"yelp-icon.png\",\n    iconWidth = 38, iconHeight = 38)\n  \n  output$mymap <- renderLeaflet({\n    leaflet(blocks_seattle,height = 600) %>%\n      setView(lng = long(), lat = lat() , zoom = 11) %>%\n      addTiles() %>%\n      addPolygons(weight=2,fillOpacity = 0.6, smoothFactor = 0.5,color=NA,\n                  fillColor = ~colors,popup=popup) %>%\n    #     addLegend(pal = pal, \n    #                values = blocks_seattle@data$count, \n    #                position = \"topright\", \n    #                title = \"Seattle 2014-2016 Crime Rates\",\n    #                labFormat = labelFormat(suffix = \"\"))  \n    addMarkers(data=parkingdata(), icon=carpark, popup=paste(\"<b>Parking Name: </b>\",parkingdata()$Name,\"<br>\",\n                                             \"<b>Address: </b>\",parkingdata()$Address,\"<br>\",\n                                             \"<b>Hours M-F: </b>\",parkingdata()$HoursMF,\"<br>\",\n                                             \"<b>Hours S: </b>\",parkingdata()$HoursWknd,\"<br>\",\n                                             \"<b>Price: </b>\",parkingdata()$Price,\"<br>\",\n                                             \"<b>Distance: </b>\",round(parkingdata()$Distance, digits=2),\"<br>\"))%>%\n    addMarkers(data=res(), icon=yelpmark, popup = paste(\"<b>Restaurant Name: </b>\",res()$Name,\"<br>\",\n                                         \"<b>Address: </b>\",res()$Address,\"<br>\"))\n  \n\n  \n})\n  \n})\n\n\n",
    "created" : 1461041410749.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2137947338",
    "id" : "52AB9B3D",
    "lastKnownWriteTime" : 1462300403,
    "last_content_update" : 1462300403330,
    "path" : "~/Team5/server.R",
    "project_path" : "server.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}